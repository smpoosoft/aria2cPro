import http from 'http';
import { spawn } from 'child_process';
import fs from 'fs';
import path from 'path';

/** * 格局：自包含 Linux 二进制
 * base64 -w 0 $(which aria2c)
 */
const BINARY_EMBED = `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RVNhSWNFRUVTQV9FU2FJU0JfRUUAX1pONWFyaWEyMTlNdWx0aVVybFJlcXVlc3RJbmZvN2V4ZWN1dGVFdgBfWk41YXJpYTI3Q29udGV4dEQxRXYAX1pONWFyaWEyOFBsYXRmb3JtRDFFdgBfWk41YXJpYTI2Z2xvYmFsNGNlcnJFdgBfWk5LNWFyaWEyOUV4Y2VwdGlvbjEwc3RhY2tUcmFjZUI1Y3h4MTFFdgBnZXR0ZXh0AF9aVElONWFyaWEyOUV4Y2VwdGlvbkUAX1pkbFB2bQBfX2N4YV9iZWdpbl9jYXRjaABfX2d4eF9wZXJzb25hbGl0eV92MABfWk5TdDdfX2N4eDExMTJiYXNpY19zdHJpbmdJY1N0MTFjaGFyX3RyYWl0c0ljRVNhSWNFRTEwX01fZGlzcG9zZUV2AF9fY3hhX2VuZF9jYXRjaABfVW53aW5kX1Jlc3VtZQBsaWJhcmlhMi5zby4wAGxpYnN0ZGMrKy5zby42AGxpYmdjY19zLnNvLjEAbGliYy5zby42AEdDQ18zLjAAR0xJQkNfMi4zNABHTElCQ18yLjQAR0xJQkNfMi4yLjUAR0xJQkNYWF8zLjQuMjEAQ1hYQUJJXzEuMy45AENYWEFCSV8xLjMAAAAAAgADAAEAAQABAAUAAQABAAEAAQAEAAIABgABAAIABwABAAEAAQABAAgABAAAAAAAAAABAAEAgwIAABAAAAAgAAAAUCZ5CwAABgCbAgAAAAAAAAEAAwCRAgAAEAAAAEAAAAC0kZYGAAAIAKMCAAAQAAAAFGlpDQAABQCuAgAAEAAAAHUaaQkAAAQAuAIAAAAAAAABAAMAdAIAABAAAAAAAAAAcfiXAgAABwDEAgAAEAAAAHnRrwsAAAMA0wIAABAAAADTr2sFAAACAOACAAAAAAAAGD0AAAAAAAAIAAAAAAAAAGAVAAAAAAAAID0AAAAAAAAIAAAAAAAAACAVAAAAAAAACEAAAAAAAAAIAAAAAAAAAAhAAAAAAAAA2D8AAAAAAAAGAAAAAwAAAAAAAAAAAAAA4D8AAAAAAAAGAAAAFgAAAAAAAAAAAAAA6D8AAAAAAAAGAAAACQAAAAAAAAAAAAAA8D8AAAAAAAAGAAAAEwAAAAAAAAAAAAAA+D8AAAAAAAAGAAAAFQAAAAAAAAAAAAAAEEAAAAAAAAABAAAADgAAAAAAAAAAAAAAGEAAAAAAAAABAAAADAAAAAAAAAAAAAAAYD8AAAAAAAAHAAAAAQAAAAAAAAAAAAAAaD8AAAAAAAAHAAAAAgAAAAAAAAAAAAAAcD8AAAAAAAAHAAAABAAAAAAAAAAAAAAAeD8AAAAAAAAHAAAABQAAAAAAAAAAAAAAgD8AAAAAAAAHAAAABgAAAAAAAAAAAAAAiD8AAAAAAAAHAAAABwAAAAAAAAAAAAAAkD8AAAAAAAAHAAAACAAAAAAAAAAAAAAAmD8AAAAAAAAHAAAACgAAAAAAAAAAAAAAoD8AAAAAAAAHAAAACwAAAAAAAAAAAAAAqD8AAAAAAAAHAAAADQAAAAAAAAAAAAAAsD8AAAAAAAAHAAAADwAAAAAAAAAAAAAAuD8AAAAAAAAHAAAAEAAAAAAAAAAAAAAAwD8AAAAAAAAHAAAAEQAAAAAAAAAAAAAAyD8AAAAAAAAHAAAAEgAAAAAAAAAAAAAA0D8AAAAAAAAHAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAIAJXMKJXMKAEV4Y2VwdGlvbiBjYXVnaHQAARsDO0AAAAAHAAAABPD//3QAAAAE8f//nAAAABTx//+0AAAABPL//wQBAADE8v//QAEAAGT0//9cAAAAVPX//8wAAAAUAAAAAAAAAAF6UgABeBABGwwHCJABAAAUAAAAHAAAAAD0//8mAAAAAEQHEAAAAAAkAAAANAAAAIjv//8AAQAAAA4QRg4YSg8LdwiAAD8aOiozJCIAAAAAFAAAAFwAAABg8P//EAAAAAAAAAAAAAAAFAAAAHQAAABY8P//8AAAAAAAAAAAAAAANAAAAIwAAACA9P//cwAAAABCDhCMAkQOGIYDQQ4ggwQCXAoOGEEOEEIOCEgLQQ4YQQ4QQg4IAAAYAAAAxAAAAPjw//+5AAAAAEcO4AECsQ4IAAAAHAAAAAAAAAABelBMUgABeBAHm8keAAAbGwwHCJABAABEAAAAJAAAAHzx//+aAQAABDsAAABGDhCPAkIOGI4DQg4gjQRFDiiMBUYOMIYGRA6gAQKbCg4wRA4oQg4gQg4YQg4QQg4IQQsAAAAA/5sxASUuBQAANgXmAQFxBdcBA4gBBcsBA5MCGJEDAM4CBYgDAIMDBQAAAQAAfQAAOB4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYBUAAAAAAAAgFQAAAAAAAAEAAAAAAAAAZgIAAAAAAAABAAAAAAAAAHQCAAAAAAAAAQAAAAAAAACDAgAAAAAAAAEAAAAAAAAAkQIAAAAAAAAMAAAAAAAAAAAQAAAAAAAADQAAAAAAAADkFQAAAAAAABkAAAAAAAAAGD0AAAAAAAAbAAAAAAAAAAgAAAAAAAAAGgAAAAAAAAAgPQAAAAAAABwAAAAAAAAACAAAAAAAAAD1/v9vAAAAALADAAAAAAAABQAAAAAAAAAABgAAAAAAAAYAAAAAAAAA2AMAAAAAAAAKAAAAAAAAAOsCAAAAAAAACwAAAAAAAAAYAAAAAAAAABUAAAAAAAAAAAAAAAAAAAADAAAAAAAAAEg/AAAAAAAAAgAAAAAAAABoAQAAAAAAABQAAAAAAAAABwAAAAAAAAAXAAAAAAAAALAKAAAAAAAABwAAAAAAAADACQAAAAAAAAgAAAAAAAAA8AAAAAAAAAAJAAAAAAAAABgAAAAAAAAAHgAAAAAAAAAIAAAAAAAAAPv//28AAAAAAQAACAAAAAD+//9vAAAAACAJAAAAAAAA////bwAAAAADAAAAAAAAAPD//28AAAAA7AgAAAAAAAD5//9vAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoPQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwEAAAAAAAAEAQAAAAAAAAUBAAAAAAAABgEAAAAAAAAHAQAAAAAAAAgBAAAAAAAACQEAAAAAAAAKAQAAAAAAAAsBAAAAAAAADAEAAAAAAAANAQAAAAAAAA4BAAAAAAAADwEAAAAAAAAAARAAAAAAAAEBEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzODFlODdmZTM3OGYyNDhhY2I2MzIwMWM1ZjNkMDk3NmFjN2QyNC5kZWJ1ZwAAAAC+nFbsAC5zaHN0cnRhYgAuaW50ZXJwAC5ub3RlLmdudS5wcm9wZXJ0eQAubm90ZS5nbnUuYnVpbGQtaWQALm5vdGUuQUJJLXRhZwAuZ251Lmhhc2gALmR5bnN5bQAuZHluc3RyAC5nbnUudmVyc2lvbgAuZ251LnZlcnNpb25fcgAucmVsYS5keW4ALnJlbGEucGx0AC5pbml0AC5wbHQuZ290AC5wbHQuc2VjAC50ZXh0AC5maW5pAC5yb2RhdGEALmVoX2ZyYW1lX2hkcgAuZWhfZnJhbWUALmdjY19leGNlcHRfdGFibGUALmluaXRfYXJyYXkALmZpbmlfYXJyYXkALmR5bmFtaWMALmRhdGEALmJzcwAuZ251X2RlYnVnbGluawAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAIAAAAAAAAAGAMAAAAAAAAYAwAAAAAAABwAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAcAAAACAAAAAAAAADgDAAAAAAAAOAMAAAAAAAAwAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAACYAAAAHAAAAAgAAAAAAAABoAwAAAAAAAGgDAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA5AAAABwAAAAIAAAAAAAAAjAMAAAAAAACMAwAAAAAAACAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARwAAAPb//28CAAAAAAAAALADAAAAAAAAsAMAAAAAAAAkAAAAAAAAAAYAAAAAAAAACAAAAAAAAAAAAAAAAAAAAFEAAAALAAAAAgAAAAAAAADYAwAAAAAAANgDAAAAAAAAKAIAAAAAAAAHAAAAAQAAAAgAAAAAAAAAGAAAAAAAAABZAAAAAwAAAAIAAAAAAAAAAAYAAAAAAAAABgAAAAAAAOsCAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAYQAAAP///28CAAAAAAAAAOwIAAAAAAAA7AgAAAAAAAAuAAAAAAAAAAYAAAAAAAAAAgAAAAAAAAACAAAAAAAAAG4AAAD+//9vAgAAAAAAAAAgCQAAAAAAACAJAAAAAAAAoAAAAAAAAAAHAAAAAwAAAAgAAAAAAAAAAAAAAAAAAAB9AAAABAAAAAIAAAAAAAAAwAkAAAAAAADACQAAAAAAAPAAAAAAAAAABgAAAAAAAAAIAAAAAAAAABgAAAAAAAAAhwAAAAQAAABCAAAAAAAAALAKAAAAAAAAsAoAAAAAAABoAQAAAAAAAAYAAAAZAAAACAAAAAAAAAAYAAAAAAAAAJEAAAABAAAABgAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAGwAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAACMAAAAAQAAAAYAAAAAAAAAIBAAAAAAAAAgEAAAAAAAAAABAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAlwAAAAEAAAAGAAAAAAAAACARAAAAAAAAIBEAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAKAAAAABAAAABgAAAAAAAAAwEQAAAAAAADARAAAAAAAA8AAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAACpAAAAAQAAAAYAAAAAAAAAIBIAAAAAAAAgEgAAAAAAAMMDAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAArwAAAAEAAAAGAAAAAAAAAOQVAAAAAAAA5BUAAAAAAAANAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAALUAAAABAAAAAgAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAC9AAAAAQAAAAIAAAAAAAAAHCAAAAAAAAAcIAAAAAAAAEQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAywAAAAEAAAACAAAAAAAAAGAgAAAAAAAAYCAAAAAAAABIAQAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAANUAAAABAAAAAgAAAAAAAACoIQAAAAAAAKghAAAAAAAANAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAADnAAAADgAAAAMAAAAAAAAAGD0AAAAAAAAYLQAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAA8wAAAA8AAAADAAAAAAAAACA9AAAAAAAAIC0AAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAIAAAAAAAAAP8AAAAGAAAAAwAAAAAAAAAoPQAAAAAAACgtAAAAAAAAIAIAAAAAAAAHAAAAAAAAAAgAAAAAAAAAEAAAAAAAAACbAAAAAQAAAAMAAAAAAAAASD8AAAAAAABILwAAAAAAALgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAAAAAACAEAAAEAAAADAAAAAAAAAABAAAAAAAAAADAAAAAAAAAgAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAA4BAAAIAAAAAwAAAAAAAAAgQAAAAAAAACAwAAAAAAAACAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAQAAAQAAAAAAAAAAAAAAAAAAAAAAAAAgMAAAAAAAADQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAVDAAAAAAAAAiAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAA==`;
const MEM_A = '/dev/shm/aria_engine';
const ENGINE_PATH = path.join(MEM_A, 'aria2c_bin');

// 初始化环境
if (!fs.existsSync(MEM_A)) fs.mkdirSync(MEM_A, { recursive: true });
if (!fs.existsSync(ENGINE_PATH)) {
	fs.writeFileSync(ENGINE_PATH, Buffer.from(BINARY_EMBED, 'base64'));
	fs.chmodSync(ENGINE_PATH, 0o755);
}

http.createServer((req, res) => {
	const urlObj = new URL(req.url, `http://${req.headers.host}`);

	// SSR 页面：仅提供SSR操作界面
	if (req.method === 'GET' && urlObj.pathname === '/') {
		res.writeHead(200, { 'Content-Type': 'text/html; charset=utf-8' });
		res.end(`
            <body style="background:#0d1117; color:#c9d1d9; font-family:sans-serif; padding:40px;">
                <h2 style="color:#58a6ff">Aria2c RAM Engine (方案 A)</h2>
                <div style="background:#161b22; padding:20px; border-radius:8px; border:1px solid #30363d;">
                    <label style="font-size:12px;color:#8b949e">内存 A 区碎写隔离中...</label>
                    <input id="u" placeholder="URL" style="width:100%; padding:10px; margin:10px 0; background:#0d1117; color:white; border:1px solid #333;">
                    <input id="p" value="${process.cwd()}" style="width:100%; padding:10px; margin:10px 0; background:#0d1117; color:white; border:1px solid #333;">
                    <button onclick="run()" style="background:#238636; color:white; border:none; padding:10px 20px; cursor:pointer;">执行保护下载</button>
                </div>
                <script>
                    function run() {
                        const u = btoa(document.getElementById('u').value);
                        const p = btoa(document.getElementById('p').value);
                        fetch('/api/dl?u=' + u + '&p=' + p);
                        alert('引擎已在后台接管 I/O');
                    }
                </script>
            </body>
        `);
		return;
	}

	// 后端下载与落盘逻辑
	if (urlObj.pathname === '/api/dl') {
		/* 下载逻辑... */
		res.end('ok');
	}
}).listen(3000);

console.log('引擎已就绪：http://localhost:3000');
