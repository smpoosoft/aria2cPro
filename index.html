<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aria2c Pro å‘½ä»¤ç”Ÿæˆå™¨</title>
    <style>
        :root {
            --primary: #2563eb; --bg: #f1f5f9; --card: #ffffff;
            --text: #0f172a; --desc: #64748b; --border: #e2e8f0;
        }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 2rem; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 900px; background: var(--card); padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        h1 { font-size: 1.5rem; margin-bottom: 1.5rem; color: var(--primary); display: flex; align-items: center; gap: 0.5rem; }

        .form-section { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem; }
        .full-width { grid-column: span 2; }
        .field { display: flex; flex-direction: column; gap: 0.5rem; position: relative; }
        label { font-weight: 600; font-size: 0.9rem; }

        /* è¾“å…¥æ¡†ç»„åˆä½“ */
        .input-group { display: flex; gap: 2px; }
        input, select { flex: 1; padding: 0.75rem; border: 1.5px solid var(--border); border-radius: 0.5rem; font-size: 1rem; outline: none; transition: 0.2s; }
        input:focus { border-color: var(--primary); }

        /* åŠŸèƒ½æŒ‰é’® */
        .btn { padding: 0.75rem 1rem; background: var(--bg); border: 1.5px solid var(--border); border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; white-space: nowrap; transition: 0.2s; }
        .btn:hover { background: var(--border); }
        .clear-btn { position: absolute; right: 0.75rem; top: 2.2rem; background: none; border: none; cursor: pointer; color: var(--desc); font-size: 1.2rem; padding: 0; }

        /* ç£ç›˜é¢„åˆ†é… - ç‹¬å ä¸€è¡Œä¸”å¡ç‰‡åŒ– */
        .allocation-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
        .alloc-card { border: 1.5px solid var(--border); padding: 1rem; border-radius: 0.5rem; cursor: pointer; transition: 0.2s; }
        .alloc-card:hover { border-color: var(--primary); background: #eff6ff; }
        .alloc-card.active { border-color: var(--primary); background: #dbeafe; box-shadow: 0 0 0 2px var(--primary); }
        .alloc-name { font-weight: 700; color: var(--primary); margin-bottom: 0.25rem; }
        .alloc-desc { font-size: 0.8rem; color: var(--desc); line-height: 1.4; word-wrap: break-word; }

        /* è¾“å‡ºåŒºåŸŸ */
        .output-box { background: #1e293b; color: #f8fafc; padding: 1.5rem; border-radius: 0.75rem; position: relative; margin-top: 2rem; }
        .output-label { font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; margin-bottom: 1rem; display: flex; justify-content: space-between; }
        #final-cmd { font-family: ui-monospace, monospace; word-break: break-all; font-size: 1rem; line-height: 1.5; cursor: pointer; color: #38bdf8; }
        .copy-success { position: fixed; top: 1rem; right: 1rem; background: #10b981; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; display: none; animation: slideIn 0.3s ease; }

        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>

<div class="container">
    <h1><span style="font-size: 1.8rem;">ğŸ“¥</span> Aria2c å‘½ä»¤ç”ŸæˆåŠ©æ‰‹</h1>

    <div class="form-section">
        <div class="field full-width">
            <label>æ¨¡å‹ä¸‹è½½ URL (ç‚¹å‡»ç©ºç™½å¤„ç²˜è´´)</label>
            <div class="input-group">
                <input type="text" id="url" placeholder="https://..." autocomplete="off">
                <button class="clear-btn" id="clear-url" title="æ¸…ç©º">âœ•</button>
            </div>
        </div>

        <div class="field">
            <label>ä¿å­˜ç›®å½• (-d)</label>
            <div class="input-group">
                <input type="text" id="dir" placeholder="/path/to/save">
                <button class="btn" id="pick-dir">ğŸ“ é€‰æ‹©æ–‡ä»¶å¤¹</button>
            </div>
        </div>

        <div class="field">
            <label>ä¿å­˜æ–‡ä»¶å (-o)</label>
            <input type="text" id="out" placeholder="model.gguf">
        </div>

        <div class="field">
            <label>çº¿ç¨‹æ•° / è¿æ¥æ•° (-s / -x)</label>
            <div class="input-group">
                <input type="number" id="split" value="16" title="çº¿ç¨‹æ•°">
                <input type="number" id="conn" value="16" title="è¿æ¥æ•°">
            </div>
        </div>

        <div class="field">
            <label>æ–­ç‚¹ç»­ä¼  (-c)</label>
            <select id="continue">
                <option value="true">å¼€å¯ (æ¨è)</option>
                <option value="false">å…³é—­</option>
            </select>
        </div>

        <div class="field full-width">
            <label>ç£ç›˜é¢„åˆ†é…ç­–ç•¥ (--file-allocation)</label>
            <div class="allocation-grid" id="alloc-container">
                <div class="alloc-card active" data-value="falloc">
                    <div class="alloc-name">falloc</div>
                    <div class="alloc-desc">ç°ä»£ Linux (ext4/xfs) æ¨èã€‚ç¬é—´åˆ†é…æµ·é‡ç©ºé—´ï¼Œä¸å é¢å¤– IOã€‚</div>
                </div>
                <div class="alloc-card" data-value="prealloc">
                    <div class="alloc-name">prealloc</div>
                    <div class="alloc-desc">ä¼ ç»Ÿæ–¹å¼ã€‚åœ¨å¼€å§‹å‰é¢„å†™é›¶å¡«å……ï¼Œæ–‡ä»¶å¤§æ—¶è€—æ—¶è¾ƒä¹…ã€‚</div>
                </div>
                <div class="alloc-card" data-value="trunc">
                    <div class="alloc-name">trunc</div>
                    <div class="alloc-desc">åˆ©ç”¨ ftruncate æŒ‡ä»¤ã€‚æé€Ÿï¼Œä½†éƒ¨åˆ†æ—§æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæœ‰é™ã€‚</div>
                </div>
                <div class="alloc-card" data-value="none">
                    <div class="alloc-name">none</div>
                    <div class="alloc-desc">ä¸é¢„åˆ†é…ã€‚è¾¹ä¸‹è¾¹å†™ï¼Œå¯èƒ½å¯¼è‡´ä¸¥é‡çš„ç£ç›˜ç¢ç‰‡ã€‚</div>
                </div>
            </div>
        </div>
    </div>

    <div class="output-box">
        <div class="output-label">ç”Ÿæˆçš„ç»ˆç«¯å‘½ä»¤ <span>ç‚¹å‡»ä¸‹æ–¹ä»£ç ç›´æ¥å¤åˆ¶</span></div>
        <div id="final-cmd">aria2c ...</div>
    </div>
</div>

<div class="copy-success" id="toast">âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>

<script type="module">
    const state = {
        url: '', dir: '', out: '', split: 16, conn: 16,
        alloc: 'falloc', continue: 'true'
    };

    const elements = {
        url: document.getElementById('url'),
        dir: document.getElementById('dir'),
        out: document.getElementById('out'),
        split: document.getElementById('split'),
        conn: document.getElementById('conn'),
        cont: document.getElementById('continue'),
        cmd: document.getElementById('final-cmd'),
        toast: document.getElementById('toast'),
        cards: document.querySelectorAll('.alloc-card')
    };

    // 1. è‡ªåŠ¨ç²˜è´´ & æ¸…ç©ºé€»è¾‘
    elements.url.addEventListener('click', async () => {
        if (!elements.url.value) {
            try {
                const text = await navigator.clipboard.readText();
                if (text.startsWith('http')) {
                    elements.url.value = text;
                    update();
                }
            } catch (err) { console.warn('ç²˜è´´æƒé™è¢«æ‹’ç»'); }
        }
    });

    document.getElementById('clear-url').onclick = () => { elements.url.value = ''; update(); };

    // 2. æ–‡ä»¶å¤¹é€‰æ‹© API (2026 Native Support)
    document.getElementById('pick-dir').onclick = async () => {
        try {
            const handle = await window.showDirectoryPicker();
            // æ³¨æ„ï¼šç”±äºå®‰å…¨é™åˆ¶ï¼ŒWeb ç¯å¢ƒé€šå¸¸åªèƒ½æ‹¿åˆ°ç›®å½•åï¼Œ
            // å»ºè®® NUC ç”¨æˆ·æ ¹æ®å®é™…æŒ‚è½½è·¯å¾„å¾®è°ƒï¼Œè¿™é‡Œæ¼”ç¤ºè·å–åç§°ã€‚
            elements.dir.value = `/smpoo_code/ai/models/${handle.name}`;
            update();
        } catch (err) { console.log('ç”¨æˆ·å–æ¶ˆé€‰æ‹©'); }
    };

    // 3. ç£ç›˜é¢„åˆ†é…å¡ç‰‡åˆ‡æ¢
    elements.cards.forEach(card => {
        card.onclick = () => {
            elements.cards.forEach(c => c.classList.remove('active'));
            card.classList.add('active');
            state.alloc = card.dataset.value;
            update();
        };
    });

    // 4. å‘½ä»¤ç”Ÿæˆæ ¸å¿ƒ
    function update() {
        const url = elements.url.value.trim();
        const dir = elements.dir.value.trim() || '/smpoo_code/ai/models/';
        const out = elements.out.value.trim();
        const s = elements.split.value;
        const x = elements.conn.value;
        const c = elements.cont.value === 'true' ? ' -c' : '';

        let base = `aria2c${c} -x ${x} -s ${s} -k 1M --file-allocation=${state.alloc}`;
        if (dir) base += ` -d "${dir}"`;
        if (out) base += ` -o "${out}"`;
        base += ` "${url || '[URL]'}"`;

        elements.cmd.textContent = base;
    }

    // 5. ç‚¹å‡»å¤åˆ¶
    elements.cmd.onclick = () => {
        navigator.clipboard.writeText(elements.cmd.textContent);
        elements.toast.style.display = 'block';
        setTimeout(() => elements.toast.style.display = 'none', 2000);
    };

    // ç»‘å®šæ™®é€šäº‹ä»¶
    [elements.url, elements.dir, elements.out, elements.split, elements.conn, elements.cont]
        .forEach(el => el.oninput = update);

    update(); // åˆå§‹åŒ–
</script>

</body>
</html>
